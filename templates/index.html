<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>나침반(Compass)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <div class="app-wrap" id="homeScreen">

        <!-- 헤더 -->
        <div class="header">
            <div class="header-left" onclick="handleClick()">🏠</div>
            <div class="header-center">
                <div class="header-subtitle">당신의 영혼을 위한 나침반</div>
                <div class="header-title">COMPASS</div>
            </div>
            <div class="header-right" onclick="handleClick()">👤</div>
        </div>

        <!-- 메인 -->
        <div class="main-content">

            <!-- 나침반 (사용자 제공) -->
            <div class="compass-wrapper" onclick="handleClick()">
                <!-- 고정 외부 링 -->
                <div class="compass-outer"></div>

                <!-- 회전하는 본체 -->
                <div class="compass-body" id="compassBody">
                    <svg class="compass-svg" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="gold" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#e8d48b" />
                                <stop offset="50%" stop-color="#c9a84c" />
                                <stop offset="100%" stop-color="#a8893a" />
                            </linearGradient>
                            <linearGradient id="needleN" x1="0.5" y1="1" x2="0.5" y2="0">
                                <stop offset="0%" stop-color="#c9a84c" />
                                <stop offset="100%" stop-color="#e85050" />
                            </linearGradient>
                            <linearGradient id="needleS" x1="0.5" y1="0" x2="0.5" y2="1">
                                <stop offset="0%" stop-color="#c9a84c" />
                                <stop offset="100%" stop-color="#8a7a5a" />
                            </linearGradient>
                            <radialGradient id="glow" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" stop-color="rgba(201,168,76,0.15)" />
                                <stop offset="100%" stop-color="rgba(201,168,76,0)" />
                            </radialGradient>
                        </defs>

                        <!-- 배경 빛 -->
                        <circle cx="150" cy="150" r="145" fill="url(#glow)" />

                        <!-- 외곽 원 -->
                        <circle cx="150" cy="150" r="140" fill="none" stroke="url(#gold)" stroke-width="2"
                            opacity="0.5" />
                        <circle cx="150" cy="150" r="130" fill="none" stroke="url(#gold)" stroke-width="0.5"
                            opacity="0.3" />

                        <!-- 눈금 그룹 -->
                        <g id="ticks" opacity="0.4"></g>

                        <!-- 방위 문자 (북쪽 십자가 포함) -->
                        <text x="150" y="38" text-anchor="middle" fill="#e85050" font-size="18" font-weight="700"
                            style="animation: crossGlow 3s ease-in-out infinite;">✝</text>
                        <text x="272" y="155" text-anchor="middle" fill="url(#gold)" font-size="14" font-weight="600"
                            opacity="0.8">E</text>
                        <text x="150" y="275" text-anchor="middle" fill="url(#gold)" font-size="14" font-weight="600"
                            opacity="0.8">S</text>
                        <text x="28" y="155" text-anchor="middle" fill="url(#gold)" font-size="14" font-weight="600"
                            opacity="0.8">W</text>

                        <!-- 바늘 (북/남) -->
                        <polygon points="150,30 142,150 150,140 158,150" fill="url(#needleN)" opacity="0.9" />
                        <polygon points="150,270 158,150 150,160 142,150" fill="url(#needleS)" opacity="0.7" />

                        <!-- 중앙 장식 -->
                        <circle cx="150" cy="150" r="12" fill="#0a0e1a" stroke="url(#gold)" stroke-width="2" />
                        <circle cx="150" cy="150" r="5" fill="url(#gold)" opacity="0.8" />
                    </svg>
                </div>
            </div>

            <!-- 방위 정보 (사용자 제공) -->
            <div class="compass-info">
                <div class="degree-display" id="degreeDisplay">---<span>°</span></div>
                <div class="direction-text" id="directionText">방향 감지 중...</div>
                <div class="status-msg" id="statusMsg">나침반을 초기화하는 중입니다...</div>
                <button class="permission-btn" id="permissionBtn" onclick="requestPermission()">나침반 권한 허용하기</button>
            </div>

            <div class="greeting-area">
                <div class="greeting-text">
                    평안하십니까, <span class="greeting-name" id="greetingName">반갑습니다</span>
                </div>
                <div class="greeting-sub">나침반이 당신의 영적 여정을 기억합니다</div>
            </div>

            <div class="info-badges">
                <div class="info-badge ai-badge">
                    🤖 김성수 목사님의 설교를 학습한 AI가 함께합니다
                </div>
                <div class="info-badge">
                    🔒 모든 상담 내용은 본인 기기에만 암호화되어 보관됩니다
                </div>
                <div class="usage-badge" id="usageBadge">
                    💬 오늘 남은 무료 상담: <strong>3/3회</strong>
                </div>
            </div>

            <div class="feature-grid">
                <div class="feature-card" onclick="handleClick('/search')">
                    <div class="feature-icon">📖</div>
                    <div class="feature-title">말씀 찾기</div>
                    <div class="feature-desc">설교·성경 구절 검색</div>
                </div>
                <div class="feature-card" onclick="handleClick('/prayer')">
                    <div class="feature-icon">🙏</div>
                    <div class="feature-title">기도문</div>
                    <div class="feature-desc">상황에 맞는 기도문 생성</div>
                </div>
                <div class="feature-card" onclick="handleClick('/devotion')">
                    <div class="feature-icon">📕</div>
                    <div class="feature-title">오늘의 묵상</div>
                    <div class="feature-desc">오늘의 말씀과 묵상 가이드</div>
                </div>
                <div class="feature-card" onclick="handleClick('/chat')">
                    <div class="feature-icon">💬</div>
                    <div class="feature-title">목사님 말씀 상담</div>
                    <div class="feature-desc">AI 영적 상담 대화</div>
                </div>
            </div>

        </div>

        <!-- 하단 입력창 -->
        <div class="bottom-bar">
            <div class="input-wrap" onclick="handleClick('/chat')">
                <button class="mic-btn">🎤</button>
                <div class="input-placeholder">고민이나 상황을 말씀해주세요...</div>
                <button class="send-btn">✈️</button>
            </div>
        </div>

    </div>

    <!-- 등록 안내 팝업 -->
    <div class="overlay" id="registerOverlay">
        <div class="register-popup">
            <div class="popup-icon">🧭</div>
            <h3>서비스 이용을 위해<br>간단한 등록이 필요합니다</h3>
            <p>맞춤형 영적 상담을 위해<br>기본 정보와 약관 동의가 필요합니다.<br>1분이면 완료됩니다.</p>
            <button class="btn-register" onclick="showRegisterScreen()">등록하고 시작하기</button>
            <button class="btn-cancel" onclick="closeRegisterOverlay()">돌아가기</button>
        </div>
    </div>

    <!-- 등록 화면 (인라인) -->
    <div class="register-screen" id="registerScreen">
        <div class="register-container">

            <div class="reg-logo-area">
                <div class="reg-logo-icon">🧭</div>
                <div class="reg-greeting">할렐루야 !</div>
                <div class="reg-service-name">
                    <strong>'나침반(Compass)'</strong>은 김성수 목사님의 강해를 통해<br>
                    귀하의 영적 고민을 함께 나누는 길잡이입니다.
                </div>
            </div>

            <div class="reg-ai-notice">
                <p>🤖 본 서비스는 김성수 목사님의 설교 자료를 학습한 <strong>AI(인공지능)</strong>가 응답합니다.<br>
                    실제 목사님이 직접 답변하시는 것이 아닙니다.</p>
            </div>

            <div class="reg-service-features">
                24시간 신앙 상담 · 설교 말씀 검색 · 성경 질문이 가능합니다
            </div>

            <div class="reg-section-title">기본 설정</div>
            <div class="reg-section-desc">
                귀하께 더 깊이 있는 답변을 드리기 위해<br>
                최소한의 정보만 활용됩니다.
            </div>

            <div class="form-group">
                <label class="form-label">성함 (닉네임)</label>
                <input type="text" class="form-input" id="userName" placeholder="예: 홍길동 또는 은혜성도">
            </div>

            <div class="form-group">
                <label class="form-label">연령대 및 성별</label>
                <div class="form-row">
                    <div class="form-select-wrap">
                        <select class="form-select" id="userAge">
                            <option value="">연령대</option>
                            <option value="10s">10대 이하</option>
                            <option value="20s">20대</option>
                            <option value="30s">30대</option>
                            <option value="40s">40대</option>
                            <option value="50s">50대</option>
                            <option value="60s">60대</option>
                            <option value="70s">70대 이상</option>
                        </select>
                    </div>
                    <div class="form-select-wrap">
                        <select class="form-select" id="userGender">
                            <option value="">성별</option>
                            <option value="male">남성</option>
                            <option value="female">여성</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">거주 지역 <span class="optional">(선택)</span></label>
                <select class="form-select" id="userRegion">
                    <option value="">선택해 주세요</option>
                    <option value="seoul">서울</option>
                    <option value="gyeonggi">경기</option>
                    <option value="incheon">인천</option>
                    <option value="busan">부산</option>
                    <option value="daegu">대구</option>
                    <option value="daejeon">대전</option>
                    <option value="gwangju">광주</option>
                    <option value="ulsan">울산</option>
                    <option value="sejong">세종</option>
                    <option value="gangwon">강원</option>
                    <option value="chungbuk">충북</option>
                    <option value="chungnam">충남</option>
                    <option value="jeonbuk">전북</option>
                    <option value="jeonnam">전남</option>
                    <option value="gyeongbuk">경북</option>
                    <option value="gyeongnam">경남</option>
                    <option value="jeju">제주</option>
                    <option value="overseas">해외</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">직업 <span class="optional">(선택)</span></label>
                <select class="form-select" id="userJob">
                    <option value="">선택해 주세요</option>
                    <option value="student">학생</option>
                    <option value="office">직장인</option>
                    <option value="self">자영업</option>
                    <option value="professional">전문직</option>
                    <option value="homemaker">주부</option>
                    <option value="retired">은퇴</option>
                    <option value="pastor">사역자/전도사</option>
                    <option value="other">기타</option>
                </select>
            </div>

            <div class="terms-area">
                <div class="terms-check">
                    <input type="checkbox" id="agreeAll" onchange="toggleAll(this)">
                    <label for="agreeAll"><strong>전체 동의</strong></label>
                </div>
                <div class="terms-check">
                    <input type="checkbox" id="agreeTerms" class="agree-item" onchange="checkAll()">
                    <label for="agreeTerms"><a href="#" onclick="openModal('termsModal'); return false;">서비스 이용약관</a>에
                        동의합니다 (필수)</label>
                </div>
                <div class="terms-check">
                    <input type="checkbox" id="agreePrivacy" class="agree-item" onchange="checkAll()">
                    <label for="agreePrivacy"><a href="#"
                            onclick="openModal('privacyModal'); return false;">개인정보처리방침</a>에 동의합니다 (필수)</label>
                </div>
                <div class="terms-check">
                    <input type="checkbox" id="agreeAI" class="agree-item" onchange="checkAll()">
                    <label for="agreeAI"><a href="#" onclick="openModal('aiModal'); return false;">AI 서비스 안내</a>를 확인했습니다
                        (필수)</label>
                </div>
            </div>

            <button class="btn-primary" id="startBtn" disabled onclick="completeRegistration()">
                정보 저장하고 시작하기
            </button>

            <div class="privacy-notice">
                <div class="privacy-icon">🔒</div>
                <p>프라이버시 보호 안내<br>
                    모든 대화는 외부 서버에 저장되지 않으며,<br>
                    귀하의 기기에만 안전하게 암호화되어 보관됩니다.</p>
            </div>

        </div>
    </div>

    <!-- 모달: 이용약관 -->
    <div class="modal-overlay" id="termsModal">
        <div class="modal-content" id="termsContent"></div>
    </div>

    <!-- 모달: 개인정보처리방침 -->
    <div class="modal-overlay" id="privacyModal">
        <div class="modal-content" id="privacyContent"></div>
    </div>

    <!-- 모달: AI 서비스 안내 -->
    <div class="modal-overlay" id="aiModal">
        <div class="modal-content" id="aiContent"></div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}?v=2.5"></script>
    <script>
        // 모달 콘텐츠 로드 (Flask 라우트 호출)
        fetch('/terms').then(r => r.text()).then(html => {
            document.getElementById('termsContent').innerHTML = html;
        });
        fetch('/privacy').then(r => r.text()).then(html => {
            document.getElementById('privacyContent').innerHTML = html;
        });
        fetch('/ai-notice').then(r => r.text()).then(html => {
            document.getElementById('aiContent').innerHTML = html;
        });
    </script>

</body>

</html>